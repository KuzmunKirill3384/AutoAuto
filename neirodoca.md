# Документация проекта робота с дистанционным управлением

## Обзор

Данный проект представляет собой программное обеспечение для управления двухколесным роботом с использованием Raspberry Pi, моторов постоянного тока и различных методов управления. Система позволяет управлять роботом с помощью клавиатуры или игрового контроллера, а также собирать данные о движении, напряжении и видео для дальнейшего анализа или обучения.

## Компоненты системы

### Аппаратное обеспечение
- Raspberry Pi
- Драйверы моторов (L298N или аналогичные)
- Два мотора постоянного тока (левое и правое колесо)
- Аналого-цифровой преобразователь MCP3008 (для измерения напряжения)
- Камера (Pi Camera или USB-камера)
- Игровой контроллер (Xbox или подобный)

### Программное обеспечение
- Python 3
- Библиотеки: RPi.GPIO, pygame, opencv-python, numpy, gpiozero, и другие (см. requirements.txt)

## Структура проекта

Проект состоит из нескольких основных скриптов:

1. **left_weel.py**, **right_weel.py**: Базовые скрипты для индивидуального управления левым и правым колесом через командную строку.
2. **both_weels.py**: Скрипт для одновременного управления обоими колесами с клавиатуры.
3. **gamepad_test.py**: Управление роботом с помощью игрового контроллера с записью данных (изображения, напряжение, управляющие воздействия).
4. **gamepad_test_cross.py** и **long_provoda_test.py**: Расширенные скрипты управления с D-pad и поддержкой записи данных и видео.

## Настройка GPIO

В проекте используются следующие схемы подключения GPIO:

### Вариант 1 (left_weel.py, right_weel.py, both_weels.py, gamepad_test.py):
- **Левое колесо**: 
  - IN1: GPIO 24
  - IN2: GPIO 23
  - EN: GPIO 25
- **Правое колесо**: 
  - IN1: GPIO 7
  - IN2: GPIO 8
  - EN: GPIO 12

### Вариант 2 (gamepad_test_cross.py):
- **Левое колесо**: 
  - IN1: GPIO 24
  - IN2: GPIO 23
  - EN: GPIO 25
- **Правое колесо**: 
  - IN1: GPIO 7
  - IN2: GPIO 8
  - EN: GPIO 12

### Вариант 3 (long_provoda_test.py):
- **Левое колесо**: 
  - IN1: GPIO 5
  - IN2: GPIO 22
  - EN: GPIO 6
- **Правое колесо**:
  - IN1: GPIO 27
  - IN2: GPIO 17
  - EN: GPIO 4

## Установка и настройка

1. **Установка зависимостей**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Подключение аппаратной части**:
   - Подключите драйверы моторов согласно одной из схем GPIO.
   - Подключите MCP3008 (для измерения напряжения) к соответствующим пинам SPI.
   - Подключите камеру (Pi Camera или USB-камеру).
   - Подключите игровой контроллер по USB или Bluetooth.

3. **Запуск программ**:
   - Для базового тестирования моторов используйте `left_weel.py` или `right_weel.py`.
   - Для управления с клавиатуры используйте `both_weels.py`.
   - Для управления с игрового контроллера используйте `gamepad_test.py`, `gamepad_test_cross.py` или `long_provoda_test.py`.

## Подробное описание скриптов

### left_weel.py и right_weel.py

Эти базовые скрипты предназначены для тестирования и управления индивидуальными колесами робота. Они позволяют:
- Запускать и останавливать мотор
- Изменять направление движения (вперед/назад)
- Регулировать скорость (низкая/средняя/высокая)

**Команды управления**:
- `r` - запустить мотор
- `s` - остановить мотор
- `f` - движение вперед
- `b` - движение назад
- `l` - низкая скорость (25% мощности)
- `m` - средняя скорость (50% мощности)
- `h` - высокая скорость (75% мощности)
- `e` - выход из программы

### both_weels.py

Скрипт для одновременного управления обоими колесами с клавиатуры. Позволяет:
- Движение вперед/назад
- Поворот налево/направо
- Вращение на месте
- Регулировку скорости

**Команды управления**:
- `w` - движение вперед
- `s` - остановка
- `a` - поворот влево
- `d` - поворот вправо
- `q` - вращение влево
- `e` - вращение вправо
- `z` - движение назад
- `1` - низкая скорость (25%)
- `2` - средняя скорость (50%)
- `3` - высокая скорость (75%)
- `x` - выход из программы

### gamepad_test.py

Скрипт для управления роботом с помощью игрового контроллера с функцией сбора данных. Позволяет:
- Управлять движением с помощью левого джойстика
- Регулировать скорость с помощью триггеров
- Записывать данные для обучения (изображения с камеры, напряжение, управляющие воздействия)

**Команды управления**:
- Левый джойстик - управление движением (вперед/назад/повороты)
- Правый триггер - увеличение скорости
- Левый триггер - уменьшение скорости
- Кнопка A - включение/выключение записи данных
- Кнопка B - аварийная остановка
- Кнопка Back - выход из программы

Данные сохраняются в следующих директориях:
- `training_data/images` - изображения с камеры
- `training_data/voltage` - данные о напряжении
- `training_data/controls` - данные об управляющих воздействиях

### gamepad_test_cross.py и long_provoda_test.py

Эти скрипты представляют собой расширенные версии управления с использованием D-pad (крестовины) контроллера. Они также поддерживают запись данных и видео для обучения. Основные отличия:
- Управление движением через D-pad вместо джойстика
- Поддержка записи видео (для версии с Pi Camera)
- Более гибкие настройки скорости (6 уровней)

**Команды управления**:
- D-pad (вверх/вниз) - движение вперед/назад
- D-pad (влево/вправо) - поворот влево/вправо
- Правый триггер - увеличение скорости
- Левый триггер - уменьшение скорости
- Кнопка A - включение/выключение записи данных
- Кнопка B - аварийная остановка
- Кнопка Back - выход из программы

Данные сохраняются в следующих директориях:
- `training_data/voltage` - данные о напряжении
- `training_data/controls` - данные об управляющих воздействиях
- `training_data/video` - видеозаписи (только для Pi Camera)

## Структура данных

### Данные об управлении
Сохраняются в формате JSON:
```json
{
  "left_speed": значение_от_-1_до_1,
  "right_speed": значение_от_-1_до_1,
  "timestamp": временная_метка
}
```

### Данные о напряжении
Сохраняются в формате JSON:
```json
{
  "voltage": значение_напряжения,
  "timestamp": временная_метка
}
```

## Безопасность и обработка ошибок

Все скрипты имеют встроенные механизмы безопасности:
- Обработка прерываний и исключений
- Корректное завершение работы при выходе (очистка GPIO)
- Проверка наличия необходимого оборудования (камера, контроллер)
- Аварийная остановка с помощью кнопки B на контроллере
- Автоматическая очистка GPIO при завершении работы с помощью atexit

## Советы по использованию

1. **Тестирование моторов**:
   - Начните с тестирования отдельных моторов с помощью `left_weel.py` и `right_weel.py`
   - Убедитесь, что оба мотора работают правильно и в нужном направлении

2. **Управление с клавиатуры**:
   - Используйте `both_weels.py` для проверки совместной работы моторов
   - Проверьте все режимы движения (вперед, назад, повороты, вращение)

3. **Управление с контроллера**:
   - Используйте `gamepad_test.py` для плавного управления с помощью джойстика
   - Или используйте `gamepad_test_cross.py`/`long_provoda_test.py` для управления с D-pad

4. **Сбор данных**:
   - Включите запись данных кнопкой A на контроллере
   - Перемещайте робота по различным траекториям для сбора разнообразных данных
   - Записанные данные можно использовать для обучения моделей машинного обучения

5. **Проблемы с напряжением**:
   - Если модуль MCP3008 не обнаружен, система продолжит работу без измерения напряжения
   - Для корректного измерения напряжения настройте правильный коэффициент преобразования

6. **Проблемы с камерой**:
   - Если камера не обнаружена, система предложит продолжить работу без неё
   - Убедитесь, что камера подключена и драйверы установлены правильно

## Заключение

Данный проект представляет собой гибкую систему для управления двухколесным роботом и сбора данных о его движении. Он может быть использован для образовательных целей, создания автономных роботов или экспериментов с машинным обучением.

При возникновении проблем или вопросов рекомендуется изучить код соответствующего скрипта, так как там содержатся подробные комментарии и объяснения работы каждого модуля.
